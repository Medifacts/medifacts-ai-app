# MediFacts.AI Backend

This repository contains a minimal proof‑of‑concept implementation of
the MediFacts.AI service described in the project summary.  The goal
is to demonstrate how you might structure a backend that accepts
medical documents, charges a one‑time analysis fee via Stripe and
returns a plain‑language explanation generated by OpenAI’s GPT‑4o
model.  The service also supports generating a PDF report, sending
the report via email and handling up to three follow‑up questions.

## Features

* Upload PDF, text or image files containing medical content【318083594920458†L14-L18】.
* Initiate a secure payment using Stripe Checkout【318083594920458†L26-L28】.
* Extract text from the uploaded document and call GPT‑4o to produce
  a human‑friendly summary in the user’s language【318083594920458†L16-L20】.
* Render the AI’s response into a PDF and allow the user to download it【318083594920458†L22-L23】.
* Optionally send the report via email【318083594920458†L24-L25】.
* Track conversation state in memory and permit up to three follow‑up
  questions【318083594920458†L20-L21】.

## Getting Started

1. **Install dependencies**.
   Run `pip install -r requirements.txt` from within the
   `medifacts_app` directory.  Note that some dependencies (e.g.
   `pytesseract`) may require system packages such as Tesseract OCR.

2. **Set your API keys**.
   Export the following environment variables or replace the placeholder
   values in `app.py`:

   * `OPENAI_API_KEY` – your OpenAI key for GPT‑4o.
   * `STRIPE_SECRET_KEY` – your Stripe secret key.

3. **Start the server**.
   Run `uvicorn app:app --reload` from the `medifacts_app` directory.

4. **Test the endpoints**.
   * `POST /upload/` with form data containing a file and optional
     email address.  The response will include a `checkout_url` that
     you should open in your browser to complete payment.
   * After payment you will be redirected to `/success/{session_id}`.
     This endpoint performs the AI analysis and returns your answer,
     a link to download the PDF and a `session_id` for follow‑ups.
   * `POST /ask/{session_id}` with form data `question=...` to
     request additional clarification.  You may repeat this up to
     three times.

## Caveats

* This demo stores all session data in memory.  For a production
  deployment you should persist sessions to a database and secure
  sensitive data.
* The email sending function is a stub.  You must configure SMTP
  credentials or integrate SendGrid as described in the summary【318083594920458†L44-L45】.
* File contents are not automatically deleted after 24–72 hours.  You
  should implement scheduled cleanup to respect users’ privacy【318083594920458†L29-L29】.
* No frontend is provided.  You can build a simple HTML or React
  interface that calls these endpoints and handles the Stripe
  redirection【318083594920458†L37-L38】.

Feel free to extend this starter code to meet your specific needs.
